<?xml version="1.0" encoding="UTF-8"?>
<project name="Task" basedir="." default="jar">

	<presetdef name="java-c">
		<javac includeantruntime="false" />
	</presetdef>

    <target name="clean" description="Delete all generated files">
        <delete dir="build" failonerror="false"/>
    	<mkdir dir="build"/>
        <delete file="lib-task/sfdc-tasks.jar"/>
    </target>

    <target name="compile" depends="clean" description="Compiles the Task">
    	<java-c srcdir="src/main/java" destdir="build" includes="task/**,deployer/**">
    		<classpath>
    			<pathelement location="lib/ant.jar"/>
    			<pathelement location="lib/commons-lang3-3.3.2.jar"/>
    			<pathelement location="lib-task/enterprise-api.jar"/>
    			<pathelement location="lib-task/metadata-api.jar"/>
    			<pathelement location="lib-task/deployment-util.jar"/>
    			<pathelement location="lib-task/dataloader-30.0.0-uber.jar"/>
    			<pathelement location="lib/force-wsc-33.0.0-uber.jar"/>
    			<pathelement location="lib/commons-codec-1.10.jar"/>
    		</classpath>
    	</java-c>
    </target>

    <target name="jar" depends="compile" description="JARs the Task">
        <jar destfile="lib-task/sfdc-tasks.jar">
        	<fileset dir="src/main/resources" includes="task/antlib.xml"/>
        	<fileset dir="build" includes="task/**"/>
        	<fileset dir="build" includes="deployer/**"/>
        </jar>
    </target>

	<target name="wsdl" description="Generate JARs from WSDLs">
		<java classname="com.sforce.ws.tools.wsdlc">
			<classpath>
				<pathelement location="lib\force-wsc-33.0.0-uber.jar"/>
			</classpath>
			<arg value="src\main\wsdl\metadata-api.wsdl"/>
			<arg value="lib-task\metadata-api.jar"/>
		</java>
		<java classname="com.sforce.ws.tools.wsdlc">
			<classpath>
				<pathelement location="lib\force-wsc-33.0.0-uber.jar"/>
			</classpath>
			<arg value="src\main\wsdl\enterprise-api.wsdl"/>
			<arg value="lib-task\enterprise-api.jar"/>
		</java>
		<java classname="com.sforce.ws.tools.wsdlc">
			<classpath>
				<pathelement location="lib\force-wsc-33.0.0-uber.jar"/>
			</classpath>
			<arg value="src\main\wsdl\deployment-util.wsdl"/>
			<arg value="lib-task\deployment-util.jar"/>
		</java>
	</target>
	
</project>