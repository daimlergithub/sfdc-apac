<!-- VF page added For Creation of Sales Leads;  Lead2Opty -->
<apex:page standardController="opportunity" extensions="SalesLeadController" lightningStylesheets="true">   
    <apex:sectionHeader title="New Sales Lead" subtitle="{!opp.Name}"/>
    <apex:form >
        <apex:pageBlock title="Sales Lead" mode="edit">
            <apex:pageMessages id="msg" />
        <!--------------  Lead Info Section -------------->
        <!--Sada Commented for ANZ Market as per Defect DF-17-->
			<apex:pageBlockSection title="Lead Information" columns="2" rendered="{!IF( NOT($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.GenericSales_LeadInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
            
            <apex:pageBlockSection title="Lead Information" columns="2" rendered="{!IF( ($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.ANZSales_LeadInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
			
        <!--------------  Dealer Info Section -------------->
            <apex:pageBlockSection title="Dealer Information" columns="2">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.GenericSales_DealerInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
            
            <!--Sada Commented for ANZ Market as per Defect DF-217-->
             <!--------------  Lead Lost Info Section -------------->
            <apex:pageBlockSection title="Lead Lost Information" columns="2" rendered="{!IF( ($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.ANZsales_LostInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>                         
            
        <!--------------  Lead Customer Info Section ------------>
            <apex:pageBlockSection title="Lead Customer Information" columns="2">
                <!--<apex:inputField value="{!opp.AccountId}" onchange="Vehrel(this.value)"/>-->
                <apex:inputField value="{!opp.AccountId}"  required="true">
                    <apex:actionSupport event="onchange" action="{!Vehrel}" rerender="pb4"/> 
                </apex:inputField>
				<apex:inputField value="{!opp.Contact__c}" required="true" /> <!-- Added By Madhusudhan as per MBANZ-148 R1/S2 -->
            </apex:pageBlockSection>

        <!--------------  Lead DMS Info Section -------------->
		<!--Sada removed this section for AU/NZ as per US MBANZ-142/137 -->
            <apex:pageBlockSection title="Lead DMS Information" columns="2"  rendered="{!IF( NOT($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.GenericSales_DMSInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
            
        <!--------------  Vehicle Info Section -------------->      
            <apex:pageBlockSection title="Vehicle Information" columns="2">
                <apex:inputField value="{!opp.Current_Vehicle_1_Text__c}" required="false"/>
                <apex:inputField value="{!opp.Description}" required="false"/>
                <apex:inputField value="{!opp.Current_Vehicle_2_Text__c}" required="false"/>
                <apex:inputField value="{!opp.Purchased_Vehicle__c}" required="false"/>
                
                
            </apex:pageBlockSection>
            
        <!--------------  Lead Processing Info Section -------------->      
        <!--Sada Commented for ANZ Market as per Defect DF-217-->

            <apex:pageBlockSection title="Lead Processing Information" columns="2" rendered="{!IF( NOT($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.GenericSales_ProcessInfo}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Lead Processing Information" columns="2" rendered="{!IF( ($Permission.AUGeneric || $Permission.NZGeneric),true,false)}">
                <apex:repeat value="{!$ObjectType.Opportunity.FieldSets.ANZsales_LeadProces}"  var="f">
                            <apex:inputField value="{!opp[f.fieldPath]}" required="{!OR(f.required, f.dbrequired)}"/>
                </apex:repeat>
            </apex:pageBlockSection>
        <!--------------  Activity Date Info Section -------------->        
            <apex:pageBlockSection title="Activity Date Information" columns="1">
                <apex:inputField value="{!opp.Pickup_Date_Time__c}" required="false"/>
            </apex:pageBlockSection>
            
        <!--------------  Date Info Section -------------->     
            <apex:pageBlockSection title="Date Information" columns="2">
                <apex:inputField value="{!opp.Visited_Showroom_Date_Time__c}" required="false"/>
                <apex:inputField value="{!opp.First_Contact_Customer_Date_Time__c}" required="false" rendered="{!(userMarket == 'TR')}"/>
                
                <!----Sada 2018/June/18 added as per defect DF-232-->
                <apex:inputField value="{!opp.Test_Drive_Date__c}" required="false" rendered="{!IF( ($Permission.AUGeneric || $Permission.NZGeneric ),true,false)}"/>                
            </apex:pageBlockSection>

        <!--------------  System Info Section -------------->     
            <apex:pageBlockSection title="System Information" columns="2">
                <apex:outputField value="{!opp.createdById}"/>
                <apex:outputField value="{!opp.lastmodifiedbyId}"/>
                <apex:inputField value="{!opp.Market__c}"/>
            </apex:pageBlockSection>
			<!-- Sada as part of Defect DF272 on June 22, 2018 -->
            <apex:pageMessages id="msg1" rendered="{!IF( NOT($Permission.AUGeneric || $Permission.NZGeneric),true,false)}"/>
            <br></br>
        
            <apex:pageBlockSection title="{!$Label.IntVehicle}" columns="1" id="IVSection">
             <apex:outputText >{!$Label.IN_Vehicle_Info_Message}</apex:outputText>
			<span style="font-size:10px">Search Format ({!$Label.CarSearchFormatText}) </span>
            <apex:pageMessages id="pgmsg"/>  
            <c:MultiselectAutocompleteComponent AvailableOptions="{!lstAvailableOptions}" SelectedOptions="{!lstSelectedOptions}" rendered="{!If(AND(isHide,OR(opp.Market__c =='NZ',opp.Market__c =='AU')),true,false)}"/>
            <apex:inputCheckbox label="Add Recommended Models" value="{!addRecommendation}"  rendered="{!If(AND(isHide,OR(opp.Market__c =='NZ',opp.Market__c =='AU')),true,false)}" />
                <apex:commandButton value=" {!$Label.AddIntVehicle}" action="{!AddIntRecord}" reRender="pb1, pgmsg" rendered="{!If(AND(opp.Market__c !='NZ',opp.Market__c !='AU'),true,false)}"/>
                <apex:pageBlockTable id="pb1" value="{!intVehicle}"  var="item" title="Vehicle Information" rendered="{!If(AND(opp.Market__c !='NZ',opp.Market__c !='AU'),true,false)}">
                    <apex:column headerValue="{!$Label.CarModel}">
                        <apex:inputField value="{!item.Car_Model__c}" onchange="UpdateModInfo(this)"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Brand}"   rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Brand__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Class}"   rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Class__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Brand}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Brand_Picklist__c}"  rendered="{!!(item.Car_Model__c != null)}" />
                        <apex:outputLabel value="{!item.Brand_Picklist__c}" rendered="{!(item.Car_Model__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Class}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Class_Picklist__c}"  rendered="{!!(item.Car_Model__c != null)}" />
                        <apex:outputLabel value="{!item.Class_Picklist__c}" rendered="{!(item.Car_Model__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Color}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Color__c}" rendered="{!!(item.Car_Model__c != null)}" />
                        <apex:outputLabel value="{!item.Color__c}" rendered="{!(item.Car_Model__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Color}"    rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Color__c}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Preferred}">
                        <apex:inputfield value="{!item.Preferred__c}" onchange="PreferredChk(this)"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.MarketLabel}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Market__c}" />
                    </apex:column>
                </apex:pageBlockTable>       
            </apex:pageBlockSection>
            
            <br></br>
            
            <apex:pageBlockSection title="{!$Label.CompVehicle}" columns="1">
                <apex:outputText >{!$Label.IN_Vehicle_Info_Message}</apex:outputText>
                <apex:pageMessages id="pgmsg1"/>
                <apex:commandButton value=" {!$Label.AddCompVehicle}" action="{!AddCompRecord}" reRender="pb2, pgmsg1" rendered="{!isHidecomp}"/>
                <apex:pageBlockTable id="pb2" value="{!compVehc}"  var="item" title="Vehicle Information">
                    <apex:column headerValue="{!$Label.CarModel}">
                        <apex:inputField value="{!item.Car_Model_Competitor__c}" onchange="UpdateModInfo(this)"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Brand}"   rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Brand__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Class}"   rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Class__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Brand}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Brand_Picklist__c}" rendered="{!!(item.Car_Model_Competitor__c != null)}"/>
                        <apex:outputLabel value="{!item.Brand_Picklist__c}" rendered="{!(item.Car_Model_Competitor__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Class}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Class_Picklist__c}"  rendered="{!!(item.Car_Model_Competitor__c != null)}" />
						<apex:outputLabel value="{!item.Class_Picklist__c}" rendered="{!(item.Car_Model_Competitor__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Color}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Color__c}" rendered="{!!(item.Car_Model_Competitor__c != null)}" />
						<apex:outputLabel value="{!item.Color__c}" rendered="{!(item.Car_Model_Competitor__c != null)}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Color}"    rendered="{!(userMarket != 'IN')}">
                        <apex:outputLabel value="{!item.Color__c}"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.Preferred}">
                        <apex:inputfield value="{!item.Preferred__c}"  onchange="PreferredChkComp(this)"/>
                    </apex:column>
                    <apex:column headerValue="{!$Label.MarketLabel}"   rendered="{!(userMarket == 'IN')}">
                        <apex:inputField value="{!item.Market__c}" />
                    </apex:column>
                </apex:pageBlockTable>       
            </apex:pageBlockSection>
            
            <br></br>
            
            <apex:pageBlockSection title="{!$Label.TradeIn}" columns="1">
            <apex:pageMessages id="msg3" />
                <apex:pageBlockTable id="pb3" value="{!tradeVehc}"  var="item" title="Vehicle Information">
                    <apex:column headerValue="{!$Label.TradeInVeh}">
                        <apex:inputField value="{!item.Trade_In_Vehicle__c}"/>
                    </apex:column>

                    <apex:column headerValue="{!$Label.Year_Manufacture}">
                        <apex:inputField value="{!item.Year_of_Manufacture__c}"/>
                    </apex:column>
                    
                    <apex:column headerValue="{!$Label.Mileage}">
                        <apex:inputField value="{!item.Mileage__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Trim}">
                        <apex:inputField value="{!item.Trim__c}" />
                    </apex:column>
                    
                </apex:pageBlockTable>       
            </apex:pageBlockSection>
            
            <apex:pageBlockSection title="{!$Label.CurrVehicle}" columns="1">
                <apex:pageBlockTable id="pb4" value="{!vehRel}"  var="item" title="Vehicle Information">
                    <apex:column headerValue="{!$Label.CarModel}">
                        <apex:outputLabel value="{!item.Vehicle_Model__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Brand}">
                        <apex:outputLabel value="{!item.Vehicle_Brand__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Class}">
                        <apex:outputLabel value="{!item.Vehicle_Class__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Mileage_Start}">
                        <apex:outputLabel value="{!item.Mileage_start__c}" />
                    </apex:column>
                    <apex:column headerValue="{!$Label.Mileage}">
                        <apex:outputLabel value="{!item.Mileage_End__c}" />
                    </apex:column>
                </apex:pageBlockTable>       
            </apex:pageBlockSection>
            
            
            <apex:actionFunction name="UpdateModInfo" action="{!UpdateModInfo}" reRender="pb1,pb2,pb3">
            </apex:actionFunction>
			<apex:actionFunction name="PreferredChk" action="{!PreferredChk}" reRender="pgmsg,pb1,pb2,pb3">
            </apex:actionFunction>
			<apex:actionFunction name="PreferredChkComp" action="{!PreferredChkComp}" reRender="pgmsg1,pb1,pb2,pb3">
            </apex:actionFunction>
            
			
            <apex:pageBlockButtons >
                <!-- Sada as part of Defect DF272 on June 22, 2018 -->
                <apex:commandButton value=" {!$Label.Save_Button} " action="{!saveOpp}" reRender="msg,msg1" rendered="{!IF( NOT($Permission.AUGeneric || $Permission.NZGeneric),true,false)}"/>
                <apex:commandButton value=" Save " action="{!saveOpp}" reRender="msg,msg1, IVSection" rendered="{!IF( ($Permission.AUGeneric || $Permission.NZGeneric),true,false)}"/>
                <apex:commandButton value=" {!$Label.Cancel}" action="{!Cancel}" />
            </apex:pageBlockButtons> 
		</apex:pageblock> 
    
        <script>
        function UpdateModelInfo(obj){      
            UpdateModel(); 
        }
        </script>
    </apex:form>
</apex:page>