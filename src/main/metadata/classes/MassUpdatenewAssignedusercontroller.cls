public without sharing class MassUpdatenewAssignedusercontroller 
{

    public MassUpdatenewAssignedusercontroller(){
    accUsr= new Account();
    usr= new user();
    NewAsignUsr= new Account();
    } 

    public Account accUsr{get;set;}
    public Account NewAsignUsr{get;set;}
    public user usr{get;set;}
    public List<WrapperMassUpdate> accountList;
    public List<WrapperMassUpdate> LeadList;
    public List<WrapperMassUpdate> vehicleList;
    public List<WrapperMassUpdate> caseList;
    Public List<User> userlst;
    
    public List<WrapperMassUpdate> getLeads() {
        LeadList = new List<WrapperMassUpdate>();
        System.debug('&&*&*&&*&*&*& accUsr.OwnerId'+accUsr.OwnerId);
        if(accUsr.OwnerId !=null)
        {
        for(Lead__c ld :[SELECT ID,Name,ownerID,Service_Advisor__c  FROM Lead__c WHERE Service_Advisor__c=:accUsr.OwnerId]){
        system.debug('Lead Records are:'+ld);
        LeadList.add(new WrapperMassUpdate(ld));        
        }
        }
        return LeadList ;
    }
    
    public List<WrapperMassUpdate> getCases(){
    System.debug('&&*&*&&*&*&*& accUsr.OwnerId'+accUsr.OwnerId);
        caseList = new List<WrapperMassUpdate>();
        if(accUsr.OwnerId !=null)
        {
        for(Case cs : [select Id,CaseNumber,Case_Dealer_User__c, OwnerID from case WHERE Case_Dealer_User__c=: accUsr.OwnerId]){
            System.debug('Case Records'+ cs);
            caseList.add(new WrapperMassUpdate(cs));
        }
        }
        System.debug('Case Records'+ caseList);
        return caseList;
    }

    public List<WrapperMassUpdate> getVehicles() {
     
     Boolean b = true;
     vehicleList = new List<WrapperMassUpdate>();
     if(accUsr.OwnerId !=null)
        {
        List<Account_Link__c> vehiclalk=new List<Account_Link__c>();
          vehiclalk=[SELECT ID,Name,torole__c,Service_Advisor__c,VIN__c,ownerID  FROM Account_Link__c WHERE Service_Advisor__c=:accUsr.OwnerId ];
       System.debug('&&*&*&&*&*&*& vehiclalk'+vehiclalk); 
        for(Account_Link__c vechicle : vehiclalk){ 
            vehicleList.add(new WrapperMassUpdate(vechicle,b)); 
        }    
        }
        system.debug('vehicleList>>>>' + vehicleList);
        return vehicleList ;
    }


    public List<WrapperMassUpdate> getAccounts() {
         accountList = new List<WrapperMassUpdate>();
         if(accUsr.OwnerId !=null)
        {
        for(Account_Link__c acc : [SELECT ID,Name,OwnerId ,Retail_Sales_Consultant__c,toRole__c FROM Account_Link__c WHERE Retail_Sales_Consultant__c=:accUsr.OwnerId  LIMIT 1000]){
            accountList.add(new WrapperMassUpdate(acc));
        }    
        }
        return accountList;
    }
    Public List<User> getUserDetails(){
        userlst = new List<user>();
        if(NewAsignUsr.Portal_Apply_User__c!=null){
            for(User usr: [SELECT iD,Firstname,lastName,Email,ProfileiD FROM User WHERE id=:NewAsignUsr.Portal_Apply_User__c]){
            userlst.add(usr);    
            }
        }
        system.debug('User details-->'+userlst);
        return userlst;
    }
    public void disPlayNewAssignUserInfo(){
    system.debug('Welcome to user:'+NewAsignUsr.Portal_Apply_User__c);
    if(NewAsignUsr.Portal_Apply_User__c!=null){
    usr=[SELECT iD,Firstname,lastName ,Email,ProfileiD,userName FROM User WHERE id=:NewAsignUsr.Portal_Apply_User__c];
    }
    }
    public void getFields() {
        getAccounts();
        getVehicles();
        getLeads();
        getUserDetails();
         
    }
    public class WrapperMassUpdate
    {
        public Account_Link__c acc{get;set;}
        public Account_Link__c veh{get;set;}
        public Lead__c led{get;set;}
        public case cse{get;set;}
        public Boolean selected{get;set;}
        
        public WrapperMassUpdate(Account_Link__c a)
        {
            acc = a;
            //veh = (Vehicle__c)a;
            // led = (Lead__c)a;
            selected = False;
        }
        public WrapperMassUpdate(Account_Link__c vh,Boolean b)
        {
            system.debug('vehicle %^%^%%%^'+vh);
            //acc = (Account)a;
            veh = (Account_Link__c)vh;
            // led = (Lead__c)a;
             system.debug('vehicle %^%^%%%^'+veh);
            selected = False;
        }
         public WrapperMassUpdate(Lead__c a){
        //acc = (Account)a;
        //veh = (Vehicle__c)a;
        led = (Lead__c)a;
        selected = False;
        }
        public WrapperMassUpdate(case cs){
            cse =  cs;
            selected = false;  
        }
    }
    
   public void massUpdateNewAssign() {
    if(NewAsignUsr.Portal_Apply_User__c!=null){
    User usr = [SELECT iD,Firstname,lastName FROM User WHERE id=:NewAsignUsr.Portal_Apply_User__c];
    
    system.debug('user record: '+usr);
    system.debug('user record: '+usr.id);
    
    system.debug('user record:accountList '+accountList);
    system.debug('user record:vehicleList  '+vehicleList );
    system.debug('user record:caseList '+caseList);
    system.debug('user record:LeadList  '+LeadList );
    

         List<Account_Link__c> SelectedAccount =new List<Account_Link__c>();
         List<Account_Link__c> SelectedVehicle =new List<Account_Link__c>();
                                List<Account_Link__c> MergeAccountlinklist =new List<Account_Link__c>();
                                Map<Id,Account_Link__c>AccountMap = new Map<Id,Account_Link__c>();
                                Map<Id,Account_Link__c>VehicleMap = new Map<Id,Account_Link__c>();
         List<Lead__c> SelectedLead =new List<Lead__c>();
         List<case> Selectedcase =new List<case>();
          system.debug('user record: '+usr);
         for(WrapperMassUpdate accupdte: accountList){
             if(accupdte.selected==true){
                 AccountMap.put(accupdte.acc.id,accupdte.acc);
                 SelectedAccount.add(accupdte.acc);
             }
                                                
         }
           if(SelectedAccount != null)
                                                {
                                                                System.debug('SAccount'+SelectedAccount);
                                                                MergeAccountlinklist.addAll(SelectedAccount);
                                                }
                                   
         List<Account_Link__c> UpdateAcc = New List<Account_Link__c>();
        /* for(Account_Link__c acc:SelectedAccount)
         {
             System.debug('INloop');
             acc.Retail_Sales_Consultant__c=usr.id;
             UpdateAcc.add(acc);
         }
         if(!UpdateAcc.isempty()){
         update UpdateAcc;
         }*/
         List<Account_Link__c> UpdateVehicle = new List<Account_Link__c>();
         for(WrapperMassUpdate vechupdt: vehicleList ){
             if(vechupdt.selected==true){
                 VehicleMap.put(vechupdt.veh.id,vechupdt.veh);
                 SelectedVehicle.add(vechupdt.veh);             
             }
         }
                                if(SelectedVehicle != null)
                                                {
                                                                MergeAccountlinklist.addAll(SelectedVehicle);
                                                }
                     if(MergeAccountlinklist != null)
                                {
                                System.debug('Mlist>>>'+MergeAccountlinklist);
            Batch_MassUpdateAccountLinkJP batcher = new Batch_MassUpdateAccountLinkJP(MergeAccountlinklist,AccountMap,VehicleMap,usr);
            Database.executeBatch(batcher, 20);

                                                
                                 }
      /*   for(Account_Link__c vh :SelectedVehicle ){
             vh.Service_Advisor__c=usr.id;
             UpdateVehicle.add(vh);
         }*/
         List<Lead__c> Updatelead = new List<Lead__c>();
         for(WrapperMassUpdate leadupdte: LeadList ){
             if(leadupdte.selected==true){
                 SelectedLead.add(leadupdte.led);
            }
         }
         
         for(Lead__c lf: SelectedLead){
         lf.Service_Advisor__c=usr.id;
         Updatelead.add(lf);
         }
         
         List<case> Updatecase = new List<case>();
         for(WrapperMassUpdate caseupdte: caseList){
             if(caseupdte.selected==true){
                 Selectedcase.add(caseupdte.cse);
             }
         }
         
         for(case cs: Selectedcase){
         cs.Case_Dealer_User__c=usr.id;
         Updatecase.add(cs);
         }
         
         if(!Updatecase.isEmpty()){
             update Updatecase;
         }
         
        /* if(!UpdateVehicle.isEmpty()){
         update UpdateVehicle;
         }*/
         if(!Updatelead.isEmpty()){
         update Updatelead;
        }   
         }
    }

    
    

}